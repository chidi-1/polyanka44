(function(g,ns){function apply(object,config,defaults){if(defaults){this.apply(object,defaults);}
if(object&&config&&typeof config==='object'){for(var i in config){if(config.hasOwnProperty(i)){object[i]=config[i];}}}
return object;}
function nsFn(ns,global){var root=global||g;var parts=ns.split('.');for(var i=0,p;(p=parts[i]);i++){root=(root[p]=root[p]||{});}
return root;}
function ensureQueryString(o,prefix){var ret;prefix=prefix||'';if(typeof o==='string'){ret=o;}else{var parts=[];for(var k in o){if(o.hasOwnProperty(k)){parts.push(k+'='+encodeURIComponent(o[k]));}}
ret=parts.join('&');}
if(prefix&&ret.length&&ret.indexOf(prefix)===-1){ret=prefix+ret;}
return ret;}
function filterObjectByFn(params,fn){var result={};for(var key in params){if(!fn(params[key]))result[key]=params[key];}
return result;}
apply(nsFn(ns),{apply:apply,ns:nsFn,isArray:function(obj){return Object.prototype.toString.call(obj)==='[object Array]';},isObject:function(obj){return obj!==null&&typeof obj==='object';},isBoolean:function(obj){return obj===!!obj;},isNumber:function(obj){return typeof obj==='number';},isString:function(obj){return typeof obj==='string';},isFunction:function(obj){return typeof obj==='function';},isUndefined:function(obj){return obj===void 0;},isEmpty:function(obj){return this.isUndefined(obj)||obj===null||obj===''||this.isArray(obj)&&obj.length===0||this.isObject(obj)&&this.isObjectEmpty(obj);},isObjectEmpty:function(obj){for(var prop in obj){if(obj.hasOwnProperty(prop))
return false;}
return true;},isArguments:function(item){return Object.prototype.toString.call(item)==='[object Arguments]';},toArray:function(args){if(this.isArray(args)){return args;}else if(this.isArguments(args)){return Array.prototype.slice.call(args);}else{return[args];}},copyArray:function(a){var b=new Array(a.length);var i=a.length;while(i--){b[i]=a[i];}
return b;},ensureQueryString:ensureQueryString,filterObjectByFn:filterObjectByFn,URL:function(url){var self=this;var regexp=new RegExp('^(([^:/\\?#]+):)?(//(([^:/\\?#]*)(?::([^/\\?#]*))?))?([^\\?#]*)(\\?([^#]*))?(#(.*))?$');this.url=url;function init(){var parts=regexp.exec(self.url);self.protocol=parts[2]||'';self.host=parts[5]||'';self.port=parts[6]||'';self.path=parts[7]||'/';self.query=parts[8]||'';self.hash=parts[10]||'';}
this.replace=function(o){o=o||{};var protocol=o.protocol||self.protocol;var host=o.host||self.host;var port=o.port||self.port;var path=o.path||self.path;var query=ensureQueryString(o.query||self.query,'?');var hash=o.hash||self.hash;return(protocol?protocol+':':protocol)+'//'+host+(port?':'+port:port)+
path+query+(hash?'#'+hash:hash);};this.toString=function(){return this.replace();};init();}});})(window,'uLiB.util');(function(g,namespace){var u=g.uLiB.util;var __cs=g['__cs'],logStyle={'[Ws]':'background: #88FF88','[Queue]':'background: #FF8866','[Aly]':'background: #FFFF66','[CallTracking]':'background: #8181F7','[PhoneReplacer]':'background: #81BEF7','[DynamicalTracking]':'background: #81FFF7','[Lead]':'background: #BDBDBD'},C={IS_IE_LT_11:!!Function('/*@cc_on return true@*/')(),IS_IE_LT_10:!window.navigator.msPointerEnabled&&!!Function('/*@cc_on return true@*/')(),IS_IE_LT_9:!g.document.addEventListener,IS_IE_LT_8:!g.document.querySelector,IS_TOUCH_DEVICE:/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||window.opera).substr(0,4)),IS_PHONE:/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||window.opera).substr(0,4)),IS_IOS:['iPad Simulator','iPhone Simulator','iPod Simulator','iPad','iPhone','iPod'].indexOf(g.navigator.platform)!==-1,IS_ANDROID:navigator.userAgent.toLowerCase().indexOf('android')!==-1,IS_FIREFOX:navigator.userAgent.toLowerCase().indexOf('firefox')!==-1,RE_EMAIL:/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/,RE_HREF:/(^|\s)(((?:http|https|ftp|):\/\/(?:[^:]+:[^@]+@)?)|(.{0}(?=www\.)))([^\s]+)+/mgi,SET_HOST:['s','e','t','H','o','s','t'].join(''),ZZZZZZ:'ZZZZZZ'},util={log:function(){var args=[].slice.call(arguments),style=logStyle[args[0]]||'';args.unshift(style);args.unshift('%c'+this.getTimeStr());this.__debug&&g.console&&console.log.apply&&console.log.apply(console,args);},error:function(){var args=[].slice.call(arguments);args.unshift('[Comagic]');this.__debug&&console.error.apply(console,args);},getDebugParam:function(name){var dp=this.__debugparams;if(!name||(name=='encodejson'&&this.isObject(dp))){return name=='encodejson'?JSON.stringify(dp):dp;}
return this.isObject(dp)&&dp[name]||'';},camelize:function(str){return str.replace(/(?:^|[-_])(\w)/g,function(_,c){return c?c.toUpperCase():'';})},sformat:function(tpl,params){var s=arguments[0],o=arguments[1],regex;if(this.isObject(o)){var field,fields={},value;regex=/{([^}]+)}/g;while(field=regex.exec(s)){field=field[1];value=o[field];if(value===undefined){continue;}
if(field=='cls'||this.endsWith(field,'Cls')){value=this.getCssSelector(value,true);}
fields[field]=value;}
for(var k in fields){if(!fields.hasOwnProperty(k)){continue;}
regex=new RegExp('\\{'+k+'\\}','gm');s=s.replace(regex,fields[k]);}}else{for(var i=0;i<arguments.length-1;i++){regex=new RegExp('\\{'+i+'\\}','gm');s=s.replace(regex,arguments[i+1]);}}
return s;},endsWith:function(str,suffix){return str.indexOf(suffix,str.length-suffix.length)!=-1;},startsWith:function(str,prefix){if(this.isArray(prefix)){for(var i=0,p;(p=prefix[i]);i++){if(this.startsWith(str,p)){return true;}}
return false;}else{return str.indexOf(prefix)==0;}},ensureEndsWith:function(str,suffix){if(!this.endsWith(str,suffix)){return str+suffix;}
return str;},stripTags:function(str){return str.replace(/(<([^>]+)>)/ig,"");},textLinksToHtml:function(str){return(''+str).replace(this.C.RE_HREF,function(){var a=arguments;return u.sformat('{0}<a href="{1}{2}">{2}</a>',a[1],a[3]||'',encodeURI(a[5]));}).replace('href="www.','href="http://www.').replace('href="://','href="http://');},crLfToBr:function(str){return str.replace(/\n\r/g,'<br/>').replace(/\r\n/g,'<br/>').replace(/\n/g,'<br/>').replace(/\r/g,'<br/>');},brToCrLf:function(str){return str.replace('/<br/>/g','\n');},strim:function(str){str=''+str;return str.replace(/\s/g,'');},getChunks:function(str,maxLength){var _str=str||'',tmpAr=_str.split(' '),result=[''];for(var i=0;i<tmpAr.length;i++){var lastItem=result[result.length-1];if(!lastItem.length||((lastItem.length+tmpAr[i].length)<maxLength-1)){result[result.length-1]=[lastItem,tmpAr[i]].join(' ').trim();}else{result.push(tmpAr[i]);}}
return result;},getCityLength:function(phone){return phone.len?phone.len:phone.prefix?phone.prefix.length-1:3;},formatPhone:function(phone){var subPhoneMask=phone.mask||'###-##-##',phoneTpl=phone.format||'+{country} ({city}) {phone}',cityLength=this.getCityLength(phone),subPhone=phone.raw&&phone.raw.substr(cityLength+1),subPhoneMaskOctothorpCount=subPhoneMask&&(subPhoneMask.match(/#/g)||[]).length,subPhoneLength=subPhone&&subPhone.length,phoneText=phone.text,count=0;if(!subPhone&&phoneText){return phoneText;}
if(subPhoneMaskOctothorpCount>subPhoneLength){for(var i=0;i<subPhoneMaskOctothorpCount-subPhoneLength;i++){subPhoneMask=subPhoneMask.replace('#','');}}else if(subPhoneMaskOctothorpCount<subPhoneLength){for(var i=0;i<subPhoneLength-subPhoneMaskOctothorpCount;i++){subPhoneMask='#'+subPhoneMask;}}
subPhone=subPhoneMask.replace(/#/g,function(){return subPhone[count++]||'';});return this.sformat(phoneTpl,{country:phone.raw.substr(0,1),city:phone.raw.substr(1,cityLength),phone:subPhone});},isNotContainsOnlyWhitespaces:function(string){return/\S/.test(string);},dformat:function(date){var d=date.getDate(),m=date.getMonth()+1,y=date.getFullYear();return''+y+'-'+(m<=9?'0'+m:m)+'-'+(d<=9?'0'+d:d);},tformat:function(date){date=date||new Date();var hours=date.getHours(),minutes=date.getMinutes();hours<10&&(hours="0"+hours);minutes<10&&(minutes="0"+minutes);return hours+':'+minutes;},dApplyTimeDelta:function(date,timeDelta){timeDelta=timeDelta||0;date=date.split(/(?:\s|T)/);date[0]=date[0].split('.');date[1]=date[1].split(':');date=new Date(date[0][2],date[0][1],date[0][0],date[1][0],date[1][1],date[1][2]);date.setTime(date.getTime()-timeDelta*1000);return date;},dnow:function(){return+new Date();},dGetTimeDelta:function(){return this.timeDelta;},dSetTimeDelta:function(delta){this.timeDelta=delta;},arrayIndexOf:function(array,obj,start){for(var i=(start||0),j=array.length;i<j;i++){if(array[i]===obj){return i;}}
return-1;},arrayIsContain:function(array,item){if(this.isArray(item)){for(var i=0,ii;(ii=item[i]);i++){if(this.arrayIsContain(array,ii)){return true;}}
return false;}else{return this.arrayIndexOf(array,item)!==-1;}},arrayForEach:function(collection,callback,scope){for(var i=0;i<collection.length;i++){callback.call(scope,collection[i],i,collection);}},arrayFilter:function(array,filterFn,scope){var ret=[];for(var i=0,ii;(ii=array[i]);i++){if(filterFn.call(scope||g,ii)!==false){ret.push(ii);}}
return ret;},inArray:function(item,array){return this.arrayIndexOf(array,item);},bind:function(func,scope,args){return function(){var _args=[].slice.call(arguments);return func.apply(scope,_args.concat(args));};},wrapEvent:function(wrapper,func,scope){return function(){var args=wrapper.apply(scope,arguments);if(args){if(uLiB.util.EventBus){uLiB.util.EventBus.fireEvent.apply(uLiB.util.EventBus,['ulib:event'].concat(args));}
return func.apply(scope,args);}
return null;};},maybeCall:function(obj,fn,scope,args){if(this.isFunction(obj)){fn=obj;}
if(this.isObject(fn)){scope=fn;}
if(this.isString(fn)&&this.isObject(obj)){fn=obj[fn];}
if(scope===void 0&&this.isObject(obj)){scope=obj;}
if(this.isArray(fn)){args=fn;}
if(this.isArray(scope)){args=scope;}
if(this.isFunction(fn)){return fn.apply(scope||this,args||[]);}
return null;},extend:function(Child,Parent){if(this.isString(Parent)){Parent=this.getObjByName(Parent);}
var F=function(){};F.prototype=Parent.prototype;Child.prototype=new F();Child.prototype.constructor=Child;Child.superclass=Parent.prototype;},mixIn:function(target,source,properties,name){var args=Array.prototype.slice.apply(arguments);target=args.shift();source=args.shift();properties=args.shift()||[];if(this.isString(source)){source=this.getObjByName(source);}
if(this.isString(properties)){name=properties;properties=[];}
if(!name){throw'Name of the mixin within the target must be specified';}
if(!source){throw'Cannot mix-in from undefined source';}
if(!target){throw'Cannot mix-in to undefined target';}
if(!target.prototype.hasOwnProperty('mixins')){var mixins=target.prototype.mixins;target.prototype.mixins={};if(mixins){for(var k in mixins){target.prototype.mixins[k]=mixins[k];}}}
source=this.isFunction(source)?source.prototype:source;if(name){target.prototype.mixins[name]=source;}
if(properties.length){for(var i=0,p;(p=properties[i]);i++){target.prototype[p]=this.isFunction(source)?source.prototype[p]:source[p];}}else{for(var p in source){target.prototype[p]=source[p];}}},isinstance:function(obj,classes){if(!this.isArray(classes)){classes=[classes];}
for(var i=0,c;(c=classes[i]);i++){if(this.isString(c)){c=this.getObjByName(c);}
if(obj instanceof c){return true;}
var mixins=obj.mixins;if(mixins){for(var j=0,m;(m=mixins[j]);j++){if(obj instanceof m){return true;}}}}
return false;},applyIf:function(object,defaults){for(var k in defaults){if(defaults.hasOwnProperty(k)&&object[k]===undefined){object[k]=defaults[k];}}
return object;},isNs:function(ns,global){if(!ns){return false;}
var root=global||g;var parts=ns.split('.');for(var i=0,p;(p=parts[i]);i++){if(!(root=root[p])){return false;}}
return true;},getObjByName:function(str){var root=g;var parts=str.split('.'),pparts=[];for(var i=0,p;(p=parts[i]);i++){if(!root[p]){this.error('Property',p,'of',pparts.join('.'),'is not an Object');return null;}
root=root[p];pparts.push(p);}
return root;},getURLParameter:function(name){return decodeURI(((new RegExp(name+'='+'(.+?)(&|$)')).exec(g.location.search)||[,''])[1]);},getHashParameter:function(name){return decodeURI(((new RegExp(name+'='+'(.+?)(&|$)')).exec(g.location.hash)||[,''])[1]);},clone:function(o){if(!o||'object'!==typeof o){return o;}
var c='function'===typeof o.pop?[]:{};var p,v;for(p in o){if(o.hasOwnProperty(p)){v=o[p];if(v&&'object'===typeof v){c[p]=this.clone(v);}else{c[p]=v;}}}
return c;},isInstance:function(obj,className){if(this.isString(className)){className=this.getObjByName(className);}
return obj instanceof className;},okeys:function(o){var ret=[];for(var k in o){if(o.hasOwnProperty(k)){ret.push(k);}}
return ret;},ovalues:function(o){var ret=[];for(var k in o){if(o.hasOwnProperty(k)){ret.push(o[k]);}}},opop:function(o,prop){var ret=o[prop];delete o[prop];return ret;},storageGet:function(key){var val=this.sessionStorage().getItem(key);if(val===null){val=this.localStorage().getItem(key);}
var ret=JSON.parse(val);if(ret&&ret.ezstorage){return ret.value;}
return ret;},storageSet:function(key,val,isPersist){return(isPersist?this.localStorage():this.sessionStorage()).setItem(key,JSON.stringify(val));},_localStorage:{items:{}},_sessionStorage:{items:{}},_storageApi:{getItem:function(key){var ret=this.items[key];return ret===void 0?null:ret;},setItem:function(key,value){this.items[key]=''+value;},removeItem:function(key){delete this.items[key];}},_checkStorage:function(storage){var key='testtesttest';storage.setItem(key,'1');storage.removeItem(key);},localStorage:function(){try{this._checkStorage(window.localStorage);return window.localStorage;}catch(e){this.log('window.localStorage not available. emulate');return this.apply(this._localStorage,this._storageApi);}},sessionStorage:function(){try{this._checkStorage(window.sessionStorage);return window.sessionStorage;}catch(e){this.log('window.sessionStorage not available. emulate');return this.apply(this._sessionStorage,this._storageApi);}},uuid:function(){var S4=function(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1);};return(S4()+S4()+'-'+S4()+'-'+S4()+'-'+
S4()+'-'+S4()+S4()+S4());},padNumber:function(n){return(n<10?'0':'')+n;},getTimeStr:function(date){date=date||new Date();return this.padNumber(date.getHours())+':'+
this.padNumber(date.getMinutes())+':'+
this.padNumber(date.getSeconds())+'.'+
date.getMilliseconds();},getTimestamp:function(){return Math.round(new Date().getTime()/1000);},getExponentialBackoff:function(backoffStep){return Math.pow(2,backoffStep)*1000+
Math.round(Math.random()*1000);},getUrlParams:function(paramsStr){var rawData=paramsStr.substring(1).split('&'),params={};for(var i=0;i<rawData.length;i++){var item=rawData[i].split('=');if(item[0]){try{params[item[0]]=decodeURIComponent(item[1]);}catch(e){}}}
return params;},getUrlQuery:function(){return this.getUrlParams(window.location.search);},getUrlHash:function(){return this.getUrlParams(window.location.hash);},prepareSelector:function(element){if(element.indexOf('/')===0){var re=/(\w+)\[(\d+)\]/;var tree=element.split('/');tree.splice(0,1);for(var i=0;i<tree.length;i++){if(re.test(tree[i])){tree[i]=tree[i].replace(re,function(str,p1,p2){return p1+':eq('+(parseInt(p2,10)-1)+')';});}}
return tree.join(' > ');}else{return element;}},getDebugExternalChatComagicWebUrl:function(){var ss=uLiB.util.sessionStorage();if(ss){return ss.getItem('cmg:debugExternalChatComagicWebUrl');}},getDeviceType:function(){if(this.C.IS_PHONE){return'Phone';}
if(this.C.IS_TABLET){return'Tablet';}
return'PC';},isObject:function(obj){return obj===Object(obj);},setDebug:function(debugMode){var cookie=uLiB.util.CookieShop,me=this;try{if(debugMode===undefined){me.__debug=me.getUrlQuery()._comagic_set_debug!==undefined?me.getUrlQuery()._comagic_set_debug:me.getUrlHash()._comagic_set_debug!==undefined?me.getUrlHash()._comagic_set_debug:me.arrayIndexOf([1,true,'true','1'],cookie.get(cookie.DEBUG))!==-1;}else{this.__debug=me.arrayIndexOf([1,true,'true','1'],debugMode)!==-1;cookie.set(cookie.DEBUG,debugMode,-1);}}catch(e){console.log(e);}},isUriLocal:function(uri){uri=encodeURIComponent(uri||document.location.href);return decodeURIComponent(uri).indexOf('file:///')===0;},init:function(){this.__debugparams=this.getURLParameter('bannerdebug');this.__debugger=this.getURLParameter('bannerdebug')==2;try{this.__debugparams=JSON.parse(this.__debugparams);}catch(e){this.log('Cannot parse debug params. Going to plain debug mode.')}
var timeDelta=this.getURLParameter('time_delta');timeDelta!==''&&this.dSetTimeDelta(timeDelta);}};C.IS_TABLET=C.IS_TOUCH_DEVICE&&!C.IS_PHONE;u.apply(util,{C:C});util.init();u.apply(u.ns(namespace,g),util);})(window,'uLiB.util');(function(g,ns){var u=g.uLiB.util,XMLHttpFactories=[function(){return new XMLHttpRequest()},function(){return new ActiveXObject('Msxml2.XMLHTTP')},function(){return new ActiveXObject('Msxml3.XMLHTTP')},function(){return new ActiveXObject('Microsoft.XMLHTTP')}];function createXMLHTTPObject(){var xmlhttp=null;for(var i=0;i<XMLHttpFactories.length;i++){try{xmlhttp=XMLHttpFactories[i]();}
catch(e){continue;}
break;}
return xmlhttp;}
u.apply(u.ns(ns),{ajax:function(url,opts){if(u.isObject(url)){opts=url;url=opts.url;}
opts=opts||{};var req=createXMLHTTPObject(),data=opts.data,complete=opts.complete;if(!req)return;var method=opts.method||(data?'POST':'GET');if(method==='GET'&&data){url=(new u.URL(url)).replace({query:data});data=undefined;}
req.open(method,url,true);if(method==='POST'&&data){req.setRequestHeader('Content-type',opts.contentType||'application/x-www-form-urlencoded; charset=UTF-8');}
req.onreadystatechange=function(){if(req.readyState!=4)return;if(req.status!=200&&req.status!=304){return;}
if(complete){opts.complete(req);}};if(req.readyState==4)return;req.send(data);}});})(window,'uLiB.util');(function(window,ns,undefined){var TIMEOUT=30*1000,TIMEOUT_SIGN='timeout';var ul=window.uLiB,u=ul.util;var JSONP=function(url,data,method,callback){url=url||'';data=data||{};method=method||'';callback=callback||function(){};var getKeys=function(obj){var keys=[];for(var key in obj){if(obj.hasOwnProperty(key)){keys.push(key);}}
return keys;};if(typeof data=='object'){var queryString='';var keys=getKeys(data);for(var i=0;i<keys.length;i++){queryString+=encodeURIComponent(keys[i])+'='+encodeURIComponent(data[keys[i]]);if(i!=keys.length-1){queryString+='&';}}
url+='?'+queryString;}else if(typeof data=='function'){method=data;callback=method;}
if(typeof method=='function'){callback=method;method='callback';}
var timestamp=(new Date()).getTime();var generatedFunction='jsonp'+Math.round(timestamp+Math.random()*1000001);window[generatedFunction]=function(json){window.clearTimeout(window[generatedFunction+TIMEOUT_SIGN]);callback(json);try{delete window[generatedFunction];delete window[generatedFunction+TIMEOUT_SIGN];}catch(e){window[generatedFunction]=undefined;window[generatedFunction+TIMEOUT_SIGN]=undefined;}};if(url.indexOf('?')===-1){url=url+'?';}
else{url=url+'&';}
var jsonpScript=document.createElement('script');jsonpScript.setAttribute('src',url+method+'='+generatedFunction);document.getElementsByTagName('head')[0].appendChild(jsonpScript);window[generatedFunction+TIMEOUT_SIGN]=window.setTimeout(window[generatedFunction],TIMEOUT);};u.apply(u.ns(ns),{jsonp:JSONP});})(window,'uLiB.util');(function(g,ns){var ul=g.uLiB,u=ul.util;var doc=document,html=doc.documentElement,byClass='getElementsByClassName',byTag='getElementsByTagName',qSA='querySelectorAll',useNativeQSA='useNativeQSA',tagName='tagName',nodeType='nodeType',select,id=/#([\w\-]+)/,clas=/\.[\w\-]+/g,idOnly=/^#([\w\-]+)$/,classOnly=/^\.([\w\-]+)$/,tagOnly=/^([\w\-]+)$/,tagAndOrClass=/^([\w]+)?\.([\w\-]+)$/,splittable=/(^|,)\s*[>~+]/,normalizr=/^\s+|\s*([,\s\+\~>]|$)\s*/g,splitters=/[\s\>\+\~]/,splittersMore=/(?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/,specialChars=/([.*+?\^=!:${}()|\[\]\/\\])/g,simple=/^(\*|[a-z0-9]+)?(?:([\.\#]+[\w\-\.#]+)?)/,attr=/\[([\w\-]+)(?:([\|\^\$\*\~]?\=)['"]?([ \w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^]+)["']?)?\]/,pseudo=/:([\w\-]+)(\(['"]?([^()]+)['"]?\))?/,easy=new RegExp(idOnly.source+'|'+tagOnly.source+'|'+classOnly.source),dividers=new RegExp('('+splitters.source+')'+splittersMore.source,'g'),tokenizr=new RegExp(splitters.source+splittersMore.source),chunker=new RegExp(simple.source+'('+attr.source+')?'+'('+pseudo.source+')?');var walker={' ':function(node){return node&&node!==html&&node.parentNode},'>':function(node,contestant){return node&&node.parentNode==contestant.parentNode&&node.parentNode},'~':function(node){return node&&node.previousSibling},'+':function(node,contestant,p1,p2){if(!node)return false;return(p1=previous(node))&&(p2=previous(contestant))&&p1==p2&&p1}};function Cache(){this.c={}}
Cache.prototype={g:function(k){return this.c[k]||undefined},s:function(k,v,r){v=r?new RegExp(v):v;return(this.c[k]=v)}};var classCache=new Cache(),cleanCache=new Cache(),attrCache=new Cache(),tokenCache=new Cache();function classRegex(c){return classCache.g(c)||classCache.s(c,'(^|\\s+)'+c+'(\\s+|$)',1)}
function each(a,fn){var i=0,l=a.length;for(;i<l;i++)fn(a[i])}
function flatten(ar){for(var r=[],i=0,l=ar.length;i<l;++i)arrayLike(ar[i])?(r=r.concat(ar[i])):(r[r.length]=ar[i])
return r}
function arrayify(ar){var i=0,l=ar.length,r=[];for(;i<l;i++)r[i]=ar[i]
return r}
function previous(n){while(n=n.previousSibling)if(n[nodeType]==1)break;return n}
function q(query){return query.match(chunker)}
function interpret(whole,tag,idsAndClasses,wholeAttribute,attribute,qualifier,value,wholePseudo,pseudo,wholePseudoVal,pseudoVal){var i,m,k,o,classes;if(this[nodeType]!==1)return false;if(tag&&tag!=='*'&&this[tagName]&&this[tagName].toLowerCase()!==tag)return false;if(idsAndClasses&&(m=idsAndClasses.match(id))&&m[1]!==this.id)return false;if(idsAndClasses&&(classes=idsAndClasses.match(clas))){for(i=classes.length;i--;)if(!classRegex(classes[i].slice(1)).test(this.className))return false}
if(pseudo&&qwery.pseudos[pseudo]&&!qwery.pseudos[pseudo](this,pseudoVal))return false;if(wholeAttribute&&!value){o=this.attributes;for(k in o){if(Object.prototype.hasOwnProperty.call(o,k)&&(o[k].name||k)==attribute){return this}}}
if(wholeAttribute&&!checkAttr(qualifier,getAttr(this,attribute)||'',value)){return false;}
return this;}
function clean(s){return cleanCache.g(s)||cleanCache.s(s,s.replace(specialChars,'\\$1'))}
function checkAttr(qualify,actual,val){switch(qualify){case'=':return actual==val;case'^=':return actual.match(attrCache.g('^='+val)||attrCache.s('^='+val,'^'+clean(val),1));case'$=':return actual.match(attrCache.g('$='+val)||attrCache.s('$='+val,clean(val)+'$',1));case'*=':return actual.match(attrCache.g(val)||attrCache.s(val,clean(val),1));case'~=':return actual.match(attrCache.g('~='+val)||attrCache.s('~='+val,'(?:^|\\s+)'+clean(val)+'(?:\\s+|$)',1));case'|=':return actual.match(attrCache.g('|='+val)||attrCache.s('|='+val,'^'+clean(val)+'(-|$)',1))}
return 0;}
function _qwery(selector,_root){var r=[],ret=[],i,l,m,token,tag,els,intr,item,root=_root,tokens=tokenCache.g(selector)||tokenCache.s(selector,selector.split(tokenizr)),dividedTokens=selector.match(dividers);if(!tokens.length)return r;token=(tokens=tokens.slice(0)).pop();if(tokens.length&&(m=tokens[tokens.length-1].match(idOnly)))root=byId(_root,m[1]);if(!root)return r;intr=q(token);els=root!==_root&&root[nodeType]!==9&&dividedTokens&&/^[+~]$/.test(dividedTokens[dividedTokens.length-1])?function(r){while(root=root.nextSibling){root[nodeType]==1&&(intr[1]?intr[1]==root[tagName].toLowerCase():1)&&(r[r.length]=root)}
return r}([]):root[byTag](intr[1]||'*');for(i=0,l=els.length;i<l;i++){if(item=interpret.apply(els[i],intr))r[r.length]=item}
if(!tokens.length)return r;each(r,function(e){if(ancestorMatch(e,tokens,dividedTokens))ret[ret.length]=e});return ret}
function is(el,selector,root){if(isNode(selector))return el==selector;if(arrayLike(selector))return!!~flatten(selector).indexOf(el);var selectors=selector.split(','),tokens,dividedTokens;while(selector=selectors.pop()){tokens=tokenCache.g(selector)||tokenCache.s(selector,selector.split(tokenizr));dividedTokens=selector.match(dividers);tokens=tokens.slice(0);if(interpret.apply(el,q(tokens.pop()))&&(!tokens.length||ancestorMatch(el,tokens,dividedTokens,root))){return true}}
return false}
function ancestorMatch(el,tokens,dividedTokens,root){var cand;function crawl(e,i,p){while(p=walker[dividedTokens[i]](p,e)){if(isNode(p)&&(interpret.apply(p,q(tokens[i])))){if(i){if(cand=crawl(p,i-1,p))return cand}else return p}}}
return(cand=crawl(el,tokens.length-1,el))&&(!root||isAncestor(cand,root))}
function isNode(el,t){return el&&typeof el==='object'&&(t=el[nodeType])&&(t==1||t==9)}
function uniq(ar){var a=[],i,j;o:for(i=0;i<ar.length;++i){for(j=0;j<a.length;++j)if(a[j]==ar[i])continue o;a[a.length]=ar[i]}
return a}
function arrayLike(o){return(typeof o==='object'&&isFinite(o.length))}
function normalizeRoot(root){if(!root)return doc;if(typeof root=='string')return qwery(root)[0];if(!root[nodeType]&&arrayLike(root))return root[0];return root}
function byId(root,id,el){return root[nodeType]===9?root.getElementById(id):root.ownerDocument&&(((el=root.ownerDocument.getElementById(id))&&isAncestor(el,root)&&el)||(!isAncestor(root,root.ownerDocument)&&select('[id="'+id+'"]',root)[0]))}
function qwery(selector,_root){var m,el,root=normalizeRoot(_root);if(!root||!selector)return[];if(selector===window||isNode(selector)){return!_root||(selector!==window&&isNode(root)&&isAncestor(selector,root))?[selector]:[]}
if(selector&&arrayLike(selector))return flatten(selector);if(m=selector.match(easy)){if(m[1])return(el=byId(root,m[1]))?[el]:[];if(m[2])return arrayify(root[byTag](m[2]));if(hasByClass&&m[3])return arrayify(root[byClass](m[3]))}
return select(selector,root)}
function collectSelector(root,collector){return function(s){var oid,nid;if(splittable.test(s)){if(root[nodeType]!==9){if(!(nid=oid=root.getAttribute('id')))root.setAttribute('id',nid='__qwerymeupscotty');s='[id="'+nid+'"]'+s;collector(root.parentNode||root,s,true);oid||root.removeAttribute('id')}
return;}
s.length&&collector(root,s,false)}}
var isAncestor='compareDocumentPosition'in html?function(element,container){return(container.compareDocumentPosition(element)&16)==16}:'contains'in html?function(element,container){container=container[nodeType]===9||container==window?html:container;return container!==element&&container.contains(element)}:function(element,container){while(element=element.parentNode)if(element===container)return 1;return 0},getAttr=function(){var e=doc.createElement('p');return((e.innerHTML='<a href="#x">x</a>')&&e.firstChild.getAttribute('href')!='#x')?function(e,a){return a==='class'?e.className:(a==='href'||a==='src')?e.getAttribute(a,2):e.getAttribute(a)}:function(e,a){return e.getAttribute(a)}}(),hasByClass=!!doc[byClass],hasQSA=doc.querySelector&&doc[qSA],selectQSA=function(selector,root){var result=[],ss,e;try{if(root[nodeType]===9||!splittable.test(selector)){return arrayify(root[qSA](selector))}
each(ss=selector.split(','),collectSelector(root,function(ctx,s){e=ctx[qSA](s);if(e.length==1)result[result.length]=e.item(0);else if(e.length)result=result.concat(arrayify(e))}));return ss.length>1&&result.length>1?uniq(result):result}catch(ex){}
return selectNonNative(selector,root)},selectNonNative=function(selector,root){var result=[],items,m,i,l,r,ss;selector=selector.replace(normalizr,'$1');if(m=selector.match(tagAndOrClass)){r=classRegex(m[2]);items=root[byTag](m[1]||'*');for(i=0,l=items.length;i<l;i++){if(r.test(items[i].className))result[result.length]=items[i]}
return result}
each(ss=selector.split(','),collectSelector(root,function(ctx,s,rewrite){r=_qwery(s,ctx);for(i=0,l=r.length;i<l;i++){if(ctx[nodeType]===9||rewrite||isAncestor(r[i],root))result[result.length]=r[i]}}));return ss.length>1&&result.length>1?uniq(result):result},configure=function(options){if(typeof options[useNativeQSA]!=='undefined')
select=!options[useNativeQSA]?selectNonNative:hasQSA?selectQSA:selectNonNative};configure({useNativeQSA:true});qwery.configure=configure;qwery.uniq=uniq;qwery.is=is;qwery.pseudos={};u.apply(u.ns(ns),{qwery:qwery});})(window,'uLiB');(function(g,ns){var ul=g.uLiB,u=ul.util,d=g.document,de=d.documentElement,modern=d.addEventListener,add=modern?'addEventListener':'attachEvent',rem=modern?'removeEventListener':'detachEvent',pre=modern?'':'on';function contentLoaded(fn){var done=false,top=true,init=function(e){if(e.type=='readystatechange'&&d.readyState!='complete')return;(e.type=='load'?g:d)[rem](pre+e.type,init,false);if(!done&&(done=true))fn.call(g,e.type||e);},poll=function(){try{de.doScroll('left');}catch(e){setTimeout(poll,50);return;}
init('poll');};if(d.readyState=='complete')fn.call(g,'lazy');else{if(!modern&&de.doScroll){try{top=!g.frameElement;}catch(e){}
if(top)poll();}
d[add](pre+'DOMContentLoaded',init,false);d[add](pre+'readystatechange',init,false);g[add](pre+'load',init,false);}}
function onun(addOrRemove,elem,event,fn){if(u.isString(elem)){var els=d.querySelectorAll(elem);for(var i=0,el;(el=els[i]);i++){onun(addOrRemove,el,event,fn);}
return;}
elem[addOrRemove?add:rem](pre+event,fn,true);}
u.apply(u.ns(ns),{on:function(elem,event,fn){onun(true,elem,event,fn);},ons:function(elem,events,fn){for(var i=0,e;(e=events[i]);i++){this.on(elem,e,fn);}},un:function(elem,event,fn){onun(false,elem,event,fn);},ready:contentLoaded});})
(window,'uLiB.util.domevent');(function(g,ns){var ul=g.uLiB,u=ul.util;u.apply(u.ns(ns),{attr:function(els,name,val){if(u.isUndefined(val)){var el=els[0];return el&&el.getAttribute(name);}
for(var i=0,el;(el=els[i]);i++){el.setAttribute(name,val);}
return this;},html:function(els,html){if(u.isUndefined(html)){return els[0].innerHTML;}
for(var i=0,el;(el=els[i]);i++){el.innerHTML=html;}
return this;},text:function(els,text){var propertyName=('innerText'in(els[0]||{}))?'innerText':'textContent';if(u.isUndefined(text)){return els[0][propertyName];}
for(var i=0,el;(el=els[i]);i++){el[propertyName]=text;}
return this;},not:function(els,notEls){var ret=[];for(var i=0,el;(el=els[i]);i++){if(notEls.indexOf(el)===-1){ret.push(el);}}
return ret;}});})(window,'uLiB.util.domhelper');(function(g,ns){var ul=g.uLiB,u=ul.util,b=document.body,d=document,de=d.documentElement;u.apply(u.ns(ns),{getWindowScrollTop:function(){if(typeof pageYOffset!='undefined'){return pageYOffset;}
else{d=(d.clientHeight)?d:b;return d.scrollTop;}},getWindowHeight:function(){return g.innerHeight||de.clientHeight||b.clientHeight;},getDocumentHeight:function(){return Math.max(b.scrollHeight,de.scrollHeight,b.offsetHeight,de.offsetHeight,b.clientHeight,de.clientHeight);},offset:function(el){var p={left:el.offsetLeft||0,top:el.offsetTop||0};while(el=el.offsetParent){p.left+=el.offsetLeft;p.top+=el.offsetTop;}
return p;}});})(window,'uLiB.util.dimension');(function(g){if(!g.uLiB){g.uLiB={}}
if(!g.uLiB.util){g.uLiB.util={};}
g.uLiB.util.IE={version:(function(){if(document.documentMode){return document.documentMode;}else{for(var i=7;i>0;i--){var div=document.createElement("div");div.innerHTML="<!--[if IE "+i+"]><span></span><![endif]-->";if(div.getElementsByTagName("span").length){return i;}}}
return undefined;})(),request:function(url,callback,postData,method,headers){var xhr;var xhrMethod=method||postData?'POST':'GET';postData=postData||'';headers=headers||{};if(typeof XMLHttpRequest!=='undefined'){xhr=new XMLHttpRequest();}else{var versions=['MSXML2.XmlHttp.5.0','MSXML2.XmlHttp.4.0','MSXML2.XmlHttp.3.0','MSXML2.XmlHttp.2.0','Microsoft.XmlHttp'];for(var i=0;i<versions.length;i++){try{xhr=new ActiveXObject(versions[i]);}catch(e){}}}
xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status==200){callback(xhr);}};xhr.open(xhrMethod,url,true);for(var h in headers){if(headers.hasOwnProperty(h)){xhr.setRequestHeader(h,headers[h]);}}
xhr.send(postData);},xrequest:function(url,callback){var xdr=new XDomainRequest();xdr.open('GET',url);xdr.onload=function(){callback({responseJSON:JSON.parse(xdr.responseText),status:200})};g.setTimeout(function(){xdr.send();},0);}};})(window);(function(g){var u=g.uLiB.util,_globals=['Comagic','__cs'],_queue=[],_commandsToWatchFor=[],_commands={};function maybeCall(obj,method,scope,args){var fn=obj[method];if(typeof fn!=='function'){return;}
return fn.apply(scope||obj,args);}
function addCommandToWatchFor(commands,obj,scope){_commandsToWatchFor.push([].slice.call(arguments));}
function log(){var args=[].concat(arguments);args.unshift('[Queue]');u.log.apply(u,args);}
for(var i=0,gName;(gName=_globals[i]);i++){if(g[gName]&&u.isArray(g[gName])){_queue=_queue.concat(g[gName]);}}
var q=g.uLiB.util.Queue={length:_queue.length,push:function(c,args){if(u.isArray(c)){return _queue.push(c);}else{return this.push([c,u.toArray(args)]);}},shift:function(index){if(u.isUndefined(index)){return _queue.shift();}
if(u.isNumber(index)){return _queue.splice(index,1)[0];}
if(u.isString(index)){for(var i=0,action;(action=_queue[i]);i++){if(u.isArray(action)&&action[0]===index){return this.shift(i);}}}},peek:function(index){if(u.isUndefined(index)){return _queue[0];}
if(u.isNumber(index)){return _queue[index];}
if(u.isString(index)){for(var i=0,action;(action=_queue[i]);i++){if(u.isArray(action)&&action[0]===index){return action;}}}
return null;},process:function(obj,scope){var qi;while(qi=_queue.shift()){this._process(qi,obj,scope);}},processCommands:function(commands,obj,scope,watch){log('going to process commands',commands,'of',obj);if(u.isBoolean(scope)){watch=scope;scope=undefined;}
if(watch){addCommandToWatchFor(commands,obj,scope);}
this._processCommands(commands,obj,scope);},register:function(obj){var cs=obj.__commands;for(var i=0,c;(c=cs[i]);i++){if(!_commands.hasOwnProperty(c)){_commands[c]=obj;}else{throw({message:'uLiB.util.Queue detected command conflict: "'+c+'"',command:c,existingObj:_commands[c],newObj:obj})}}},registerAndProcess:function(commands,obj,scope,watch){this.register(obj);this.processCommands(commands,obj,scope,watch);},_process:function(item,obj,scope){if(!item){return null;}
item=u.copyArray(item);var method,args;method=item.shift();args=item.length===1&&u.isArray(item[0])?item[0]:item;log(u.sformat('processing {0}({1})',method,args));return maybeCall(obj,method,scope||obj,args);},_processCommands:function(commands,obj,scope){if(!this.length){return;}
for(var i=0,c,co;(c=commands[i]);i++){if(obj.__commands&&obj.__commands.indexOf(c)!==-1){co=this.shift(c);if(this._process(co,obj,scope)===false){log('smth. wrong with',c,co,'pushing back');this.push(co);}}}}};window.setInterval(function(){for(var i=0,w;(w=_commandsToWatchFor[i]);i++){q._processCommands.apply(q,w);}},100);})(window);(function(g,ns){var ul=g.uLiB,u=ul.util,_$=uLiB.$,backend=uLiB.util.localStorage();u.apply(u.ns(ns),{Storage:{makeKey:function(key){return key+ComagicWidget.settings.uniquePostfix();},getItem:function(key){var rec=JSON.parse(backend.getItem(this.makeKey(key)));if(rec&&'__value__'in rec){if(rec.__expires__&&rec.__expires__<u.dnow()){this.removeItem(key);return null;}else{return rec.__value__;}}else{return rec;}},setItem:function(key,value,expires){value=value===undefined?null:value;backend.setItem(this.makeKey(key),JSON.stringify({__value__:value,__expires__:expires&&expires+u.dnow()}));},removeItem:function(key){backend.removeItem(this.makeKey(key));}}});})(window,'ComagicWidget.widget.common');(function(g,ns){var ul=g.uLiB,u=ul.util,_$=uLiB.$;function Observable(o){this.initObservable();}
Observable.prototype.initObservable=function(){this.events={};};Observable.prototype.on=function(eventName,callback,scope){if(u.isObject(eventName)){scope=eventName.scope;for(var k in eventName){if(eventName.hasOwnProperty(k)){this.on(k,eventName[k],scope);}}}
var listeners=this.events[eventName]||[];listeners.push({fn:callback,scope:scope});this.events[eventName]=listeners;};Observable.prototype.un=function(eventName,callback){var listeners=this.events[eventName]||[],tmp=[];for(var i=0,lr;(lr=listeners[i]);i++){if(lr.fn!==callback){tmp.push(lr);}}
this.events[eventName]=tmp;};Observable.prototype.fireEvent=function(eventName){var args=Array.prototype.slice.apply(arguments),listeners;eventName=args.shift();listeners=this.events[eventName]||[];for(var i=0,lr;(lr=listeners[i]);i++){lr.fn.apply(lr.scope||this,args);}};Observable.prototype.hasListeners=function(eventName){return!!(this.events[eventName]&&this.events[eventName].length);};u.apply(u.ns(ns),{Observable:Observable});})(window,'uLiB.util');(function(g,ns){var ul=g.uLiB,u=ul.util,_$=uLiB.$;function EventBus(o){EventBus.superclass.constructor.apply(this,arguments);}
u.extend(EventBus,'uLiB.util.Observable');u.apply(u.ns(ns),{EventBus:new EventBus()});})(window,'uLiB.util');if(!window.console){window.console={};}
if(!window.console.log){window.console.log=function(){};}
try{window.__cs_onReplacePhones=window.__cs_onReplacePhones||function(phones){return true;};window.Comagic=window.__cs=uLiB.util.apply(new function(){if(!window.uLiB){window.uLiB={};}
var u=uLiB.util;this.push=function(param){u.Queue.push(param);};var SiteSettings={_namesOfScripts:['cs.min.js','comagic.min.js','comagic.debug.js'],_scriptNameRe:/[^\/]+\.js/,_hostRe:/\/\/([^\/]+)/,_webHost:null,_siteKey:null,_readyCallbacks:[],_urlTpl:'//{0}{1}',_urls:{settings:'/ss/settings/'},_isReady:function(){return!!(this._siteKey);},_checkReady:function(){if(this._isReady()){this._onReady();}},_onReady:function(){var cb;while(cb=this._readyCallbacks.shift()){cb(this.info());}},_sformat:function(format){var args=Array.prototype.slice.call(arguments,1);return format.replace(/{(\d+)}/g,function(match,number){return typeof args[number]!='undefined'?args[number]:match;});},_getSessionStorageParam:function(itemName,fieldName){var ss=u.sessionStorage();if(!ss){return null;}
var item=JSON.parse(ss.getItem(itemName));if(arguments.length==1){return item;}
return item&&item[fieldName];},_getWebHost:function(){var sessionWebHost=this._getSessionStorageParam('comagic-widget:settings','web_host');if(sessionWebHost){return sessionWebHost;}
var scripts=document.getElementsByTagName('script'),src,fileMatch,hostMatch;for(var i=0,s;(s=scripts[i]);i++){src=s.getAttribute('src');fileMatch=this._scriptNameRe.exec(src);if(fileMatch&&u.arrayIndexOf(this._namesOfScripts,fileMatch[0])!==-1){hostMatch=this._hostRe.exec(src);return hostMatch&&hostMatch[1];}}
return null;},_composeUrl:function(mnemonic,type){var webHost={script:this._getSessionStorageParam('comagic-widget:settings','script_host')}[type]||this.getWebHost();return this._sformat(this._urlTpl,webHost,mnemonic&&this._sformat(this._urls[mnemonic])||'');},_composeScriptsUrl:function(path,jsList){return this._sformat('//{0}{1}??{2}',this._getWebHost(),path,jsList.join(','));},getSiteKey:function(){return SiteSettings._siteKey;},_getCachedSettings:function(){return ComagicWidget.widget.common.Storage.getItem('_cmg_sitesettings');},_onSiteSettingsLoad:function(r){if(!r||r.status!==200){console.log('SiteSettings request failed',r);return;}
if(!r.responseJSON){r.responseJSON=JSON.parse(r.responseText);}
if(!r.responseJSON||!r.responseJSON.success){console.log('SiteSettings request is not successful',r);return;}
var d=r.responseJSON.data;d.ttl&&ComagicWidget.widget.common.Storage.setItem('_cmg_sitesettings',d,d.ttl);this._processSiteSettings(d);},_processSiteSettings:function(d){var me=this;me._siteSettings=d;uLiB.util.EventBus.fireEvent('ss:sitesettingsload',me);d.js&&me._loadScripts(d.js_path,d.js);},_loadScripts:function(path,jsList){this._loadScript(this._composeScriptsUrl(path,jsList));},_loadScript:function(url,callback){var script=document.createElement('script');script.src=url;script.onload=callback;document.head.appendChild(script);},_getServerBaseUrl:function(){var consultantServerUrl=ss.getHost()||ss.params('consultant').server_url,u=new uLiB.util.URL(consultantServerUrl),newPParts=[],pparts=u.path.split('/');for(var i=0,p,len=pparts.length;(p=pparts[i],i<len);i++){if(p!=='comagic'){newPParts.push(p);}}
if(newPParts.length===1){newPParts.push('');}
return u.replace({path:newPParts.join('/'),protocol:'https'})},getWebHost:function(){var ss=uLiB.util.sessionStorage(),url;if(ss){url=ss.getItem('cmg:comagicWebUrl');}
if(!url){url=SiteSettings._webHost||(SiteSettings._webHost=SiteSettings._getWebHost());}
return url;},request:function(mnemonic,callback){var url=this._composeUrl(mnemonic);if(u.IE.version<=9&&window.XDomainRequest){u.IE.xrequest(url+'?sk='+this.getSiteKey(),callback);}else{u.ajax({url:url,crossDomain:true,method:'GET',data:{sk:this.getSiteKey(),pl:u.getDeviceType().toLowerCase()},complete:callback});}},init:function(){var q=uLiB.util.Queue;q.registerAndProcess(this.__commands,this,true);var ss=this._getCachedSettings();if(ss){this._processSiteSettings(ss);}else{SiteSettings.request('settings',this._onSiteSettingsLoad.bind(this));}},__commands:['setAccount',u.C.SET_HOST,'setCsAccount','setCsHost','setWebUrl','waitForSiteSettingsAndRun'],setAccount:function(key){this._siteKey=key;this._checkReady();},setHost:function(host){this._host=host;this._checkReady();},setCsAccount:function(key){this.setAccount(key);},setCsHost:function(host){this.setHost(host);},setWebUrl:function(host){this._webHost=(new u.URL(host)).host;},waitForSiteSettingsAndRun:function(callback){if(this._siteSettings){callback.call(this);}else{return false;}},ready:function(callback){if(SiteSettings._isReady()){callback(this.info());}else{SiteSettings._readyCallbacks.push(callback);}},getHost:function(){return SiteSettings._host;},info:function(){var me=SiteSettings;return{key:me.getSiteKey(),host:me.getHost(),web_host:me.getWebHost()}},uniquePostfix:function(){return SiteSettings.getSiteKey().substring(0,5);}};var ss=SiteSettings;u.apply(u.ns('ComagicWidget.settings'),{ready:ss.ready,key:ss.getSiteKey,host:ss.getHost,webHost:ss.getWebHost,info:ss.info,uniquePostfix:ss.uniquePostfix,params:function(component){return ss._siteSettings[component]},getServerBaseUrl:ss._getServerBaseUrl});SiteSettings.init();},window.Comagic,window.__cs);}catch(e){console.log(e);}
(function(g,ns){var ul=g.uLiB,u=ul.util,cookieDomain=document.domain.indexOf('www.')==0?document.domain.substring(4):document.domain,Cookie={};Cookie.set=function(name,value,expires){if(u.isUndefined(value)){this.remove(name);}
expires=expires||2*365*24*60*60*1000;var expiresDate=new Date();var cookie=[];expiresDate.setTime(expiresDate.getTime()+expires);cookie.push(name+'='+encodeURIComponent(value));cookie.push('path=/');this.getDomain()&&cookie.push('domain='+Cookie.getDomain());expires!=-1&&cookie.push('expires='+expiresDate.toGMTString());document.cookie=cookie.join(';');};Cookie.get=function(name){var prefix=name+'=';var cookieStartIndex=document.cookie.indexOf(prefix);if(cookieStartIndex==-1)
return null;var cookieEndIndex=document.cookie.indexOf(';',cookieStartIndex+prefix.length);if(cookieEndIndex==-1)
cookieEndIndex=document.cookie.length;return decodeURIComponent(document.cookie.substring(cookieStartIndex+prefix.length,cookieEndIndex));};Cookie.remove=function(name){document.cookie=name+'=; expires='+new Date(0).toGMTString()+'; domain='+Cookie.getDomain()+'; path=/;';};Cookie.getDomain=function(){return cookieDomain;};Cookie.setDomain=function(domain){cookieDomain=domain;var v='cmgtest';this.set(v,v);if(v!=this.get(v)){cookieDomain=null;}
this.remove(v);};Cookie.isEnabled=function(){return navigator.cookieEnabled||("cookie"in document&&(document.cookie.length>0||(document.cookie="test").indexOf.call(document.cookie,"test")>-1));};var ComagicCookie=function(name,ttl,key){var me=this;me.name=name;me.ttl=ttl;me.key=key||'';};ComagicCookie.prototype.getName=function(){return this.name+this.key.substring(0,5);};ComagicCookie.prototype.set=function(value,ttl){Cookie.set(this.getName(),value,ttl||this.ttl);};ComagicCookie.prototype.get=function(){return Cookie.get(this.getName());};ComagicCookie.prototype.remove=function(){Cookie.remove(this.getName());};var CookieShop={BANNER_STATE:'_comagic_banner_state',DEBUG:'_comagic_debug',DT:'_cmg_dt',WS_OFFLINE:'_comagic_offline',ALY_OFFLINE:'_comagic_aly_offline',PHONE_REPLACEMENT:'_comagic_phr',COMAGIC_ID:'_comagic_id',SESSION:'_comagic_session',VISITOR:'_comagic_visitor',_separator:'||',_ciSeparator:'.',_expires:null,_setupExpires:function(){if(!this._expires){this._expires={};this._expires[this.DEBUG]=-1;this._expires[this.DT]=30*60*1000;this._expires[this.WS_OFFLINE]=30*60*1000;this._expires[this.ALY_OFFLINE]=30*60*1000;this._expires[this.SESSION]=30*60*1000;this._expires[this.COMAGIC_ID]=2*365*24*60*60*1000;}},_getExpires:function(name){return this._expires[name];},setup:function(info){this._setupExpires();this.key=info.key||'';},getName:function(name){return name+ComagicWidget.settings.uniquePostfix();},set:function(name,value,expires){return Cookie.set(this.getName(name),value,expires||this._getExpires(name));},get:function(name){return Cookie.get(this.getName(name));},del:function(name){return this.remove(name);},remove:function(name){return Cookie.remove(this.getName(name));},getVisitorId:function(){var ci=this.getComagicId();return ci?ci.split(this._ciSeparator)[0]:null;},getVisitorObsolete:function(){var tmp=this.get(this.VISITOR);tmp=tmp?tmp.split(this._separator):[];return{key:tmp[0],id:tmp[1]};},getSessionId:function(){var ci=this.getComagicId();return ci?ci.split(this._ciSeparator)[1]:null;},getSessionObsolete:function(){var tmp=this.get(this.SESSION);tmp=tmp?tmp.split(this._separator):[];return{key:tmp[0]};},setComagicId:function(comagicId){this.set(this.COMAGIC_ID,comagicId);},getComagicId:function(){return this.get(this.COMAGIC_ID);}};u.apply(u.ns(ns),{Cookie:Cookie,ComagicCookie:ComagicCookie,CookieShop:CookieShop});ComagicWidget.settings.ready(function(info){CookieShop.setup(info);u.setDebug();});})(window,'uLiB.util');var ComagicCaptcha=function(api_url,jquery){jquery=jquery||window.uLiB.$;var _apiRequest=function(method,params,callback){if(jquery){if(uLiB.util.IE.version<=9&&window.XDomainRequest){var xdr=new XDomainRequest();xdr.open('POST',api_url);xdr.onload=function(){callback(JSON.parse(xdr.responseText).result)};xdr.send(JSON.stringify({method:method,params:params||{}}));}else{jquery.ajax({url:api_url,crossDomain:true,data:JSON.stringify({method:method,params:params||{}}),type:'POST',dataType:'json',headers:{'Content-Type':'application/json'},success:function(data){callback(data.result);}})}}else{var request_data={method:method,params:params||{}};uLiB.util.IE.request(api_url,_apiResponse(callback),JSON.stringify(request_data),'POST',{'Content-Type':'application/json'});}};var _apiResponse=function(callback){return function(xhr){var response=JSON.parse(xhr.responseText);response.success&&callback(response.result);}};this.get_captcha=function(callback,params){_apiRequest('get_captcha',params||{},callback);};};(function(g,ns){var ul=g.uLiB,u=ul.util,de=uLiB.util.domevent,dm=uLiB.util.dimension,q=uLiB.qwery,scrollEvents={scrollStart:null,scrollEnd:null,scrollTo:{}},clickEvents={},linkEvents={},externalLink='_external_link_',host=document.location.host.indexOf('www.')==0?document.location.host.slice(4):document.location.host,zzzz;var Events={notifyOnEvent:function(eventId){u.log('Sending event notification, event:',eventId);ComagicWidget.widget.analytics.Analytics.notifiOnEvent(eventId);},isElementVisible:function(element){if(element){var viewTop=dm.getWindowScrollTop();var viewBottom=dm.getWindowHeight()+viewTop;var elementTop=dm.offset(element).top;var elementBottom=elementTop+element.clientHeight;return((elementBottom<=viewBottom)&&(elementTop>=viewTop));}else{return false;}},clickEventHandler:function(event){for(var selector in clickEvents){if(clickEvents.hasOwnProperty(selector)){var els=q(selector);for(var i=0,el;(el=els[i]);i++){if(event.target===el){this.notifyOnEvent(clickEvents[selector]);break;}}}}},linkEventHandler:function(event){for(var re in linkEvents){if(!linkEvents.hasOwnProperty(re)){continue;}
if(re==externalLink){if(event.target.href&&event.target.href.indexOf(host)==-1){this.notifyOnEvent(linkEvents[re]);break;}}else if(event.target.href&&event.target.href.match(new RegExp(re))){this.notifyOnEvent(linkEvents[re]);break;}}},scrollStartHandler:function(event){de.un(window,'scroll',Events.scrollStartHandler);Events.notifyOnEvent(scrollEvents['scrollStart']);},scrollEndHandler:function(event){if(dm.getWindowScrollTop()+dm.getWindowHeight()===dm.getDocumentHeight()){de.un(window,'scroll',Events.scrollEndHandler);Events.notifyOnEvent(scrollEvents['scrollEnd']);}},scrollToHandler:function(event){for(var el in scrollEvents['scrollTo']){if(scrollEvents['scrollTo'].hasOwnProperty(el)&&this.isElementVisible(el)){this.notifyOnEvent(scrollEvents['scrollTo'][el]);delete scrollEvents['scrollTo'][el];}}},onAlyTrackview:function(aly,session){var s=session,events=s.es,clickEvents=events&&events.ce,linkEvents=events&&events.le,scrollEvents=events&&events.se,timers=events&&events.tm;clickEvents&&this.setupClickEvents(clickEvents);linkEvents&&this.setupLinkEvents(linkEvents);scrollEvents&&this.setupScrollEvents(scrollEvents);timers&&this.setupTimers(timers);},setupClickEvents:function(list){for(var i=0,ev;(ev=list[i]);i++){clickEvents[uLiB.util.prepareSelector(list[i][1])]=list[i][0];}
de.on(document,'click',u.bind(this.clickEventHandler,this));},setupLinkEvents:function(list){for(var i=0,ev;(ev=list[i]);i++){linkEvents[ev[1]]=ev[0];}
de.on('a','click',u.bind(this.linkEventHandler,this));},setupScrollEvents:function(list){this.scrollStartHandler=u.bind(this.scrollStartHandler,this);this.scrollEndHandler=u.bind(this.scrollEndHandler,this);for(var i=0,ev;(ev=list[i]);i++){if(list[i][1]=='comagic_scroll_start'){scrollEvents['scrollStart']=list[i][0];de.on(window,'scroll',this.scrollStartHandler);}else if(list[i][1]=='comagic_scroll_end'){scrollEvents['scrollEnd']=list[i][0];de.on(window,'scroll',this.scrollEndHandler);}else{scrollEvents['scrollTo'][uLiB.util.prepareSelector(list[i][1])]=list[i][0];}}
if(scrollEvents['scrollTo']){this.scrollToHandler=u.bind(this.scrollToHandler,this);de.on(window,'scroll',this.scrollToHandler);}},setupTimers:function(list){var me=this;for(var i=0,tm;(tm=list[i]);i++){(function(event,timeout){setTimeout(function(){me.notifyOnEvent(event)},timeout)})(list[i][0],list[i][1]*1000);}}};uLiB.util.EventBus.on({'aly:trackview':Events.onAlyTrackview,scope:Events});})(window,'ComagicWidget.widget.analytics');(function(g,ns){var ul=g.uLiB,u=ul.util,_startTime=u.getTimestamp();var INTERVAL_UA_DETECTION=300,TIMEOUT_UA_DETECTION=5;u.apply(u.ns(ns),{UA:{detect:function(onUaReady){u.log('[UA]','.detect(',onUaReady,')');if(onUaReady){this.callback=onUaReady;}
try{window[window['GoogleAnalyticsObject']](u.bind(this.onReady,this));}catch(e){if(this.haveToTryAgain()){u.log('[UA]','Unable to detect UA Client ID. Next try in',INTERVAL_UA_DETECTION,'ms');window.setTimeout(u.bind(this.detect,this),INTERVAL_UA_DETECTION);}else{u.log('[UA]','Unable to detect UA Client ID. Drop it (');}}},onReady:function(tracker){try{u.log('[UA]','.onReady()');this.clientId=tracker?tracker.get('clientId'):window[window['GoogleAnalyticsObject']].getAll()[0].get('clientId');u.log('[UA]','clientId detected. Going to run the callback...');this.callback&&this.callback(this.clientId);u.log('[UA]','callback has run');}catch(e){u.log('[UA]','Can\'t detect UA Client ID or callback failed',e);}},haveToTryAgain:function(){return u.getTimestamp()-_startTime<TIMEOUT_UA_DETECTION;}}});})(window,'ComagicWidget.widget.analytics');(function(g,ns){var COUNTER_DETECTION_TIMEOUT=25;var COUNTER_DETECTION_INTERVAL=100;var ul=g.uLiB,u=ul.util,q=uLiB.util.Queue,startTime;var Ym={__commands:['callYmApi'],prefix:'yaCounter',init:function(ymId){if(!ymId||this.counter){return;}
var me=this;if(!startTime){startTime=u.getTimestamp();}
this.counter=g[me.prefix+ymId];if(!me.counter&&u.getTimestamp()-startTime<COUNTER_DETECTION_TIMEOUT){g.setTimeout(function(){me.init(ymId);},COUNTER_DETECTION_INTERVAL);return;}
if(me.counter){q.registerAndProcess(me.__commands,me,true);}},callYmApi:function(methodName,args,callback,scope){if(!this.counter){return false;}
if(!u.isArray(args)){args=[args];}
var ret=this.counter[methodName].apply(this.counter,args);if(callback){callback.call(scope||this,ret);}},sendYmCustomParams:function(params){q.push('callYmApi',['params',params]);}};u.apply(u.ns(ns),{Ym:Ym});q.push('waitForTrackViewAndRun',function(opts){var ymId=opts.session.ym;if(ymId){var params={visitorID:{}};params.visitorID[Comagic.getVisitorId()]={sessionID:Comagic.getSessionId()};Ym.init(opts.session.ym);Ym.sendYmCustomParams(params);}});})(window,'ComagicWidget.widget.analytics');(function(g){var ul=g.uLiB,u=ul.util,dh=u.domhelper,q=ul.qwery,cookie=u.CookieShop,visitorIdElementText;var VisitorIdEmbedder={embedVisitorId:function(settings){if(settings.tg){var selector=u.prepareSelector(settings.tg);var els=q(selector);if(els){try{if(visitorIdElementText===undefined){visitorIdElementText=dh.text(els);}
var visitorId=cookie.getVisitorId();dh.text(els,(visitorIdElementText||'')
+(settings.pr?settings.pr:'')
+(visitorId.length<=+settings.tl?visitorId:visitorId.slice(-settings.tl)));}catch(e){u.log(e);}}}},onAlyTrackview:function(analytics,session){this.embedVisitorId(u.apply({},session.ve));}};uLiB.util.EventBus.on({'aly:trackview':VisitorIdEmbedder.onAlyTrackview,scope:VisitorIdEmbedder});})(window);(function(g,ns){var TRACK_VIEW_INIT=0,TRACK_VIEW_SENT=1,TRACK_VIEW_DONE=2;var ul=g.uLiB,u=ul.util,cookie=uLiB.util.CookieShop,bus=uLiB.util.EventBus,serverUrl,pingInterval,sessionTtl,pingIntervalId,siteKey,session={},lastServerRequestTime,trackViewState=TRACK_VIEW_INIT,callbackQueryParamName='cb';var Analytics={__commands:['waitForTrackViewAndRun','trackEvent','trackSysEvent','setProperty','getProperty','hasProperty','deleteProperty','extendDtPhoneReservationTime'],init:function(){if(u.isUriLocal()){u.log('[Aly]','Local URI disallowed');return;}
var params=ComagicWidget.settings.params('analytics'),info=ComagicWidget.settings.info();if(!params){u.log('[Aly]','No params specified');return;}
siteKey=info.key;serverUrl=params.server_url;pingInterval=params.ping_interval;sessionTtl=params.session_ttl;ComagicWidget.widget.analytics.UA.detect(u.bind(this.onUaDetected,this));this.trackView();},goOnSession:function(){var me=this;me.startPing();g.setTimeout(function(){me.stopSession();},sessionTtl);uLiB.util.Queue.registerAndProcess(this.__commands,this,true);},stopSession:function(){bus.fireEvent('aly:stopsession',this);this.stopPing();},startPing:function(){var me=this;pingIntervalId=g.setInterval(function(){me.ping();},pingInterval);},stopPing:function(){g.clearInterval(pingIntervalId);},trackView:function(){var ret=this.request('/t/v/',{ur:document.location.href,ti:document.title,re:document.referrer,la:navigator.language,sc:screen.width+'x'+screen.height,uc:ComagicWidget.widget.analytics.UA.clientId||''},this.onTrackView);trackViewState=TRACK_VIEW_SENT;return ret;},trackEvent:function(category,action,label,value){return this.request('/t/e/',{ca:category,ac:action,la:label,va:value});},trackSysEvent:function(mnemonic){return this.request('/t/se/',{ce:mnemonic});},setProperty:function(propName,propValue){return this.request('/p/s/',{pn:propName,pv:propValue});},getProperty:function(propName,callback){return this.request('/p/g/',{pn:propName},callback);},hasProperty:function(propName,callback){return this.request('/p/h/',{pn:propName},callback);},deleteProperty:function(propName){return this.request('/p/d/',{pn:propName});},setUaClientId:function(clientId){return this.request('/ua/sc/',{uc:ComagicWidget.widget.analytics.UA.clientId||clientId});},ping:function(){return this.request('/e/p/');},notifiOnEvent:function(eventId){return this.request('/e/e/',{ei:eventId});},extendDtPhoneReservationTime:function(callback){return this.request('/dct/pn/',{},callback);},waitForTrackViewAndRun:function(fn,params){var me=this,wrapper=function(){fn.call(me,u.apply({session:session},params));};if(uLiB.util.isEmpty(session)){u.log('[Aly]','No analytics session. Wait a bit');return false;}else{wrapper();}},getComagicId:function(){var ret=session.ci||cookie.getComagicId();if(ret==='undefined'){ret=undefined;}
return ret;},getHitId:function(){return session.hi;},performCommands:function(commandsList){if(!commandsList||!commandsList.length){return;}
for(var i=0,cmd,cn,cp,len=commandsList.length;(i<len);i++){cmd=commandsList[i];cn=cmd.name;cp=cmd.params;this.commandPerformers[cn].call(this,cp);}},request:function(path,params,specialCallback){u.log('[Aly]',u.sformat('request({0})',path,params,specialCallback));var me=this,composedParams=me.composeParams(path,params);for(var k in composedParams){if(composedParams.hasOwnProperty(k)){var cp=composedParams[k];if(u.isEmpty(cp)){delete composedParams[k];}}}
return u.jsonp(serverUrl+path,composedParams,callbackQueryParamName,function(response){if(!response||!response.success){u.log('[Aly]','Got unsuccessful response on '+path+': ',response);bus.fireEvent('aly:requesterror',this,path,params);return;}
me.onRequestComplete.apply(me,response.result);specialCallback&&specialCallback.apply(me,response.result);});},composeParams:function(path,params){var requiredParams={sk:siteKey,t:lastServerRequestTime,ci:this.getComagicId(),hi:session.hi,_vi:cookie.getVisitorObsolete().id,_si:cookie.getSessionObsolete().key};if(path==='/t/v/'){delete requiredParams['hi'];}
if(!requiredParams['t']){delete requiredParams['t'];}
if(requiredParams['ci']){delete requiredParams['_vi'];delete requiredParams['_si'];}
return u.apply(requiredParams,params);},onUaDetected:function(uaClientId){var me=this,cmd=function(){me.setUaClientId(uaClientId);};if(trackViewState===TRACK_VIEW_SENT){uLiB.util.Queue.push('waitForTrackViewAndRun',cmd);}else if(trackViewState===TRACK_VIEW_DONE){cmd();}},onRequestComplete:function(result,requestTime,commandsList){u.log('[Aly]','onRequestComplete(',result,requestTime,commandsList,')');lastServerRequestTime=requestTime;this.performCommands(commandsList);return true;},onTrackView:function(result){session=result;if(session.cd){uLiB.util.Cookie.setDomain(session.cd);}
if(session.ce===false){cookie.set(cookie.ALY_OFFLINE,'2');}else{cookie.del(cookie.ALY_OFFLINE);}
session.ci&&cookie.setComagicId(session.ci);bus.fireEvent('aly:trackview',this,session);trackViewState=TRACK_VIEW_DONE;this.goOnSession();},commandPerformers:{hide_dt_phones:function(params){bus.fireEvent('aly:hide_dt_phones',this,params);},enable_phone_replacement:function(params){bus.fireEvent('aly:enable_phone_replacement',this,params);},disable_phone_replacement:function(params){bus.fireEvent('aly:disable_phone_replacement',this,params);}}};uLiB.util.Queue.push('waitForSiteSettingsAndRun',function(){Analytics.init();});u.apply(u.ns(ns),{Analytics:Analytics});})(window,'ComagicWidget.widget.analytics');(function(g,ns){var ul=g.uLiB,u=ul.util,_$=uLiB.$;var ActivityMonitor={events:'mousemove keydown wheel DOMMouseScroll mousewheel mousedown touchstart touchmove MSPointerDown MSPointerMove',onActivity:function(){this.lastActivityTime=u.getTimestamp();},startWatch:function(){uLiB.util.domevent.ons(document.body,this.events.split(' '),u.bind(this.onActivity,this));return this;}};u.apply(u.ns(ns),{ActivityMonitor:ActivityMonitor});})(window,'ComagicWidget.widget.calltracking');(function(g,ns){var ul=g.uLiB,u=ul.util,bus=uLiB.util.EventBus,$=uLiB.$;u.apply(u.ns(ns),{MutationObserver:{MutationObserver:window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,eventDelay:200,lastEventTime:undefined,interval:undefined,observer:undefined,lastInnerHTML:undefined,_DOMSubtreeModifiedSupported:undefined,defaultCallback:function(){if(this.lastEventTime&&new Date().getTime()-this.lastEventTime<this.eventDelay){return;}
this.lastEventTime=new Date().getTime();bus.fireEvent('mutationobserver:change',this);},addMutationEventListener:function(element,event,callback){if(element.addEventListener){element.addEventListener(event,callback,false);return true;}
if(element.attachEvent){element.attachEvent('on'+event,callback);return true;}
return false;},removeMutationEventListener:function(element,event,callback){if(element.removeEventListener){element.removeEventListener(event,callback,false);}else if(element.detachEvent){element.detachEvent('on'+event,callback);}},isDOMSubtreeModifiedSupported:function(){var me=this;if(this._DOMSubtreeModifiedSupported===undefined){var p=document.createElement('p');this._DOMSubtreeModifiedSupported=false;if(this.addMutationEventListener(p,'DOMSubtreeModified',function(){me._DOMSubtreeModifiedSupported=true})){p.appendChild(document.createElement('p'));}}
return this._DOMSubtreeModifiedSupported;},start:function(){var me=this,observerConf={childList:true,subtree:true};if(this.MutationObserver){this.observer=new this.MutationObserver(function(mutations){me.observer.disconnect();bus.fireEvent('mutationobserver:change',me);me.observer.observe(document.body,observerConf);});this.observer.observe(document.body,observerConf);}else if(me.isDOMSubtreeModifiedSupported()){this.addMutationEventListener(document.body,'DOMSubtreeModified',me.defaultCallback);}else{this.lastInnerHTML=document.body.innerHTML;this.interval=setInterval(function(){if(me.lastInnerHTML!=document.body.innerHTML){me.lastInnerHTML=document.body.innerHTML;me.defaultCallback();}},100);}},stop:function(){var me=this;if(this.MutationObserver){this.observer&&this.observer.disconnect();}
else if(this.isDOMSubtreeModifiedSupported()){this.removeMutationEventListener(document.body,'DOMSubtreeModified',me.defaultCallback);}
if(this.interval){this.interval&&clearInterval(this.interval);this.interval=undefined;}}}});})(window,'ComagicWidget.widget.calltracking');(function(g,ns){var ul=g.uLiB,u=ul.util,dh=u.domhelper,q=ul.qwery;var PhoneReplacer={defaultPhonesObj:{},_replacedNumbers:{},getDefaultPhones:function(){var result=[];for(var k in this.defaultPhonesObj){if(this.defaultPhonesObj.hasOwnProperty(k)){result.push(this.defaultPhonesObj[k]);}}
return result;},addDefaultPhone:function(pdata){if(!(pdata.id in this.defaultPhonesObj)){this.defaultPhonesObj[pdata.id]=pdata;}},formatPhones:function(phones){var p,i,_phones=[];if(phones){for(i=0;i<phones.length;i++){p=phones[i];if(!p.img&&p.raw){p.text=uLiB.util.formatPhone(p);}
_phones.push(u.apply({},p));}
phones=_phones;}
return phones;},replacePhoneImage:function(selector,id,src,dontSaveDefaultPhones){var els=q(selector);!dontSaveDefaultPhones&&this.addDefaultPhone({id:id,img:dh.attr(els,'src'),text:null,raw:null});dh.attr(els,'src',src);},replacePhoneText:function(selector,id,text,raw,dontSaveDefaultPhones){var aEls=q('a'+selector).filter(function(el){return el.href.indexOf('tel:')!==-1});if(aEls.length){!dontSaveDefaultPhones&&this.addDefaultPhone({id:id,img:null,text:dh.html(aEls),raw:(dh.attr(aEls,'href')||'').split('tel:')[1]});dh.html(aEls,text).attr(aEls,'href','tel:+'+raw);}
var els=dh.not(q(selector),aEls);if(els.length){!dontSaveDefaultPhones&&this.addDefaultPhone({id:id,img:null,text:dh.html(els),raw:null});dh.html(els,text);}},replacePhone:function(o,dontSaveDefaultPhones){var pTag=o.id,pText=o.text,pImg=o.img,pRaw=o.raw;if(pTag&&pTag.indexOf('number=')!==0){try{var selector=uLiB.util.prepareSelector(pTag);if(pImg!==null){this.replacePhoneImage(selector,pTag,pImg,dontSaveDefaultPhones);}else if(pText){this.replacePhoneText(selector,pTag,pText,pRaw,dontSaveDefaultPhones);}}catch(e){}}else{pTag&&this.textNodeReplace(o,dontSaveDefaultPhones);}},textNodeReplace:function(o){var _clearNumber=o.id.replace('number=',''),_numberToFind=this._replacedNumbers[_clearNumber]||_clearNumber,_regExpBase='\\+?'+_numberToFind.split('').join("(?:[\\s\\-\\(\\)]*)?"),_regExp=new RegExp(_regExpBase,'g'),_finder=function(node,fn){for(var i=0,child;(child=node.childNodes[i]);i++){if(child.nodeType===3){child.data.trim()&&fn(child);}else if(child.nodeType===1&&_disabledTags.indexOf(child.tagName)===-1){_finder(child,fn)}}},_replacer=function(node){node.nodeValue=node.nodeValue.replace(_regExp,o.text);},_disabledTags=['SCRIPT'];this._replacedNumbers[_clearNumber]=o.text.replace(/\D+/g,'');_finder(document.body,_replacer);},embed:function(phones,dontSaveDefaultPhones){phones=this.formatPhones(phones);try{if(window.__cs_onReplacePhones&&typeof window.__cs_onReplacePhones==='function'&&!window.__cs_onReplacePhones(phones)){return;}}catch(e){u.log('[PhoneReplacer]','      : '+e);}
if(phones){for(var i=0;i<phones.length;i++){this.replacePhone(phones[i],dontSaveDefaultPhones);}}},embedDefault:function(){var defaultPhones=this.getDefaultPhones();u.log('[PhoneReplacer]','embedDefault(',defaultPhones,')');if(defaultPhones.length){this.embed(defaultPhones);}}};u.apply(u.ns(ns),{PhoneReplacer:PhoneReplacer});})(window,'ComagicWidget.widget.calltracking');(function(g,ns){var ul=g.uLiB,u=ul.util,q=u.Queue,cookie=uLiB.util.CookieShop,am=ComagicWidget.widget.calltracking.ActivityMonitor,phoneReplacer=ComagicWidget.widget.calltracking.PhoneReplacer;var cookieName=cookie.DT,expire=cookie._expires[cookieName],dtInterval=undefined,checkActivityTimeoutId=undefined,waitActivityForProlongNumberIntervalId=undefined;var DynamicalTracking={setup:function(phones,ttl,dtActivityInterval){u.log('[DynamicalTracking]','.setup(',phones,ttl,dtActivityInterval,')');this.cleanupProlongationMonitoring();this.phones=phones||null;this.ttl=ttl||null;this.reserveTime=uLiB.util.getTimestamp();this.dtActivityInterval=dtActivityInterval;this.expire=new Date().getTime()+cookie._expires[cookieName];am.startWatch();},saveCookie:function(){var ls=u.localStorage();ls.setItem(cookieName,this.stringify());},loadCookie:function(){var ls=u.localStorage();var data=this.parse(ls.getItem(cookieName));if(new Date().getTime()<=data.expire){u.apply(this,this.parse(ls.getItem(cookieName)));}else{this.delCookie();}},delCookie:function(){var ls=u.localStorage();ls.removeItem(cookieName);},prolongNumber:function(){u.log('[DynamicalTracking]','.prolongNumber');var me=this;q.push('extendDtPhoneReservationTime',function(result){me.onProlongNumber(result);});},onProlongNumber:function(ttl){u.log('[DynamicalTracking]','.onProlongNumber(',ttl,')');this.ttl=ttl;this.reserveTime=uLiB.util.getTimestamp();if(!ttl){this.phones=[];}
this.saveCookie();if(ttl){this.enableProlongationMonitoring();}},waitActivityForProlongNumber:function(maxInterval){u.log('[DynamicalTracking]','.waitActivityForProlongNumber',maxInterval);var me=this,startWaitingTime=u.getTimestamp();waitActivityForProlongNumberIntervalId=setInterval(function(){if((u.getTimestamp()-startWaitingTime)>maxInterval){me.disableProlongationMonitoring();return;}
if(startWaitingTime<am.lastActivityTime){me.disableProlongationMonitoring();me.prolongNumber();}},100);},cleanupProlongationMonitoring:function(){checkActivityTimeoutId&&clearTimeout(checkActivityTimeoutId);checkActivityTimeoutId=undefined;waitActivityForProlongNumberIntervalId&&clearInterval(waitActivityForProlongNumberIntervalId);waitActivityForProlongNumberIntervalId=undefined;},enableProlongationMonitoring:function(){u.log('[DynamicalTracking]','.enableProlongationMonitoring');var me=this;me.cleanupProlongationMonitoring();if(me.ttl&&me.dtActivityInterval){var timeout=me.reserveTime+me.ttl-me.dtActivityInterval-u.getTimestamp();u.log('[DynamicalTracking]','timeout:',timeout,'me.reserveTime:',me.reserveTime,'me.ttl:',me.ttl,'me.dtActivityInterval:',me.dtActivityInterval,'now:',u.getTimestamp());if(timeout>0){u.log('[DynamicalTracking]','Schedule to check up the visitor activity in ',timeout,'secs');checkActivityTimeoutId=setTimeout(function(){me.waitActivityForProlongNumber(me.dtActivityInterval);},timeout*1000);}else if((me.dtActivityInterval+timeout)>0){me.waitActivityForProlongNumber(me.dtActivityInterval+timeout);}}else{u.log('[DynamicalTracking]','.enableProlongationMonitoring','FAILED. me.ttl:',me.ttl,'me.dtActivityInterval:',me.dtActivityInterval);}},disableProlongationMonitoring:function(){u.log('[DynamicalTracking]','.disableProlongationMonitoring');this.cleanupProlongationMonitoring();},showPhones:function(){u.log('[DynamicalTracking]','.showPhones(',this.phones,')');var me=this;if(me.phones){me.enableProlongationMonitoring();phoneReplacer.embed(me.phones);}},hidePhones:function(numb){u.log('[DynamicalTracking]','.hidePhones');dtInterval&&clearInterval(dtInterval);dtInterval=undefined;this.disableProlongationMonitoring();if(numb){for(var i=0,po;(po=this.phones[i]);i++){if(po.raw===numb){phoneReplacer.embed(u.arrayFilter(ComagicWidget.widget.common.Storage.getItem('_cmg_phones'),function(it){return it.raw===numb;}));}}
this.phones=u.arrayFilter(this.phones,function(it){return it.raw!==numb;});this.saveCookie();}else{this.delCookie();phoneReplacer.embed(ComagicWidget.widget.common.Storage.getItem('_cmg_phones'));}},stringify:function(){var me=this;return JSON.stringify({dtai:me.dtActivityInterval,ph:me.phones,ttl:me.ttl,rt:me.reserveTime,expire:me.expire});},parse:function(raw){var data=JSON.parse(raw)||{};return{dtActivityInterval:data.dtai,phones:data.ph,ttl:data.ttl,reserveTime:data.rt,expire:data.expire}}};u.apply(u.ns(ns),{DynamicalTracking:DynamicalTracking});})(window,'ComagicWidget.widget.calltracking');(function(g,ns){var ul=g.uLiB,u=ul.util,storage=ComagicWidget.widget.common.Storage,cookie=uLiB.util.CookieShop,isDynamicalReplacementEnabled=false,mutationObserver=ComagicWidget.widget.calltracking.MutationObserver,dt=ComagicWidget.widget.calltracking.DynamicalTracking,phoneReplacer=ComagicWidget.widget.calltracking.PhoneReplacer;var CallTracking={__commands:['setDynamicalReplacement'],getEnabled:function(){return storage.getItem('_cmg_phr')!==false;},setEnabled:function(isEnabled){storage.setItem('_cmg_phr',!!isEnabled);},storePhones:function(phones){storage.setItem('_cmg_phones',phones);},removePhones:function(){storage.removeItem('_cmg_phones');},replacePhonesFromStorage:function(){if(cookie.get(cookie.ALY_OFFLINE)=='2'){return u.log('[CallTracking]','Offline. Stop working');}
if(!storage.getItem('_cmg_phones')){return;}
if(!this.getEnabled()){return;}
var phones=storage.getItem('_cmg_phones');u.log('[CallTracking]','About to replace phones from local storage',phones);phoneReplacer.embed(phones);dt.loadCookie();dt.showPhones();},setDynamicalReplacement:function(v){u.log('[CallTracking]','.setDynamicalReplacement]',v);if(isDynamicalReplacementEnabled!=v){isDynamicalReplacementEnabled=!!v;if(isDynamicalReplacementEnabled){mutationObserver&&mutationObserver.start();}else{mutationObserver&&mutationObserver.stop();}}},onAlyTrackview:function(analytics,session){u.log('[CallTracking]','.onAlyTrackview',analytics,session);var me=this;uLiB.util.domevent.ready(function(){if('pr'in session){me.setEnabled(session.pr);}
phoneReplacer.embedDefault();if('pt'in session){var phones=phoneReplacer.formatPhones(session.pt);me.storePhones(phones);session.pr&&phoneReplacer.embed(phones);}else{me.removePhones();}
if('dp'in session){dt.setup(session.dp,session.dt,session.da);dt.saveCookie();session.pr&&dt.showPhones();}else{dt.delCookie();}});},onAlyStopSession:function(aly){dt.hidePhones();},onAlyEnablePhoneReplacement:function(analytics,params){this.setEnabled(true);this.replacePhonesFromStorage();},onAlyDisablePhoneReplacement:function(analytics,params){this.setEnabled(false);phoneReplacer.embedDefault();},onAlyHideDtPhone:function(params){dt.hidePhones(params.numb);},onMutationObserverChange:function(mutationObserver){this.replacePhonesFromStorage();}};u.apply(u.ns(ns),{});ComagicWidget.settings.ready(function(info){uLiB.util.domevent.ready(function(){isDynamicalReplacementEnabled&&mutationObserver.start();uLiB.util.Queue.registerAndProcess(CallTracking.__commands,CallTracking,true);});});uLiB.util.EventBus.on({'aly:trackview':CallTracking.onAlyTrackview,'aly:stopsession':CallTracking.onAlyStopSession,'aly:enable_phone_replacement':CallTracking.onAlyEnablePhoneReplacement,'aly:disable_phone_replacement':CallTracking.onAlyDisablePhoneReplacement,'aly:hide_dt_phones':CallTracking.onAlyHideDtPhone,'mutationobserver:change':CallTracking.onMutationObserverChange,scope:CallTracking});})(window,'ComagicWidget.widget.calltracking');(function(g,ns){var ul=g.uLiB,u=ul.util,$=uLiB.$,cookie=u.CookieShop,dt=ComagicWidget.widget.calltracking.DynamicalTracking;function sendMessage(name,params,callback){api.push(['sendMessage',[name,params,callback]]);}
var api={push:function(param){uLiB.util.Queue.push(param);},setAccount:function(key){this.push(['setAccount',[key]]);},setHost:function(url){this.push([u.C.SET_HOST,[url]]);},setDynamicalReplacement:function(v){this.push(['setDynamicalReplacement',[v]]);},setWebUrl:function(url){this.push(['setWebUrl',[url]]);},sitePhoneCall:function(params,callback){this.push(['sitePhoneCall',[params,callback]]);},addOfflineRequest:function(req,callback){if(req.name||req.email||req.phone||req.message){ComagicWidget.widget.common.Http.addOfflineRequest(req,true,callback);}},openChatWindow:(function(){if(!u.C.IS_TOUCH_DEVICE){return function(){ComagicWidget.widget.consultant.Consultant.openChatWindow();}}else{return function(){ComagicWidget.widget.consultant.ConsultantView.onChatPopup(null,{action:'consultant'});}}})(),openSitePhonePanel:(function(){if(!u.C.IS_TOUCH_DEVICE){return function(){ComagicWidget.widget.consultant.Consultant.openSitePhonePanel();}}else{return function(){ComagicWidget.widget.consultant.ConsultantView.onChatPopup(null,{action:'site_phone'});}}})(),openSiteRequestPanel:(function(){if(!u.C.IS_TOUCH_DEVICE){return function(){ComagicWidget.widget.consultant.Consultant.openSiteRequestPanel();}}else{return function(){ComagicWidget.widget.consultant.ConsultantView.onChatPopup(null,{action:'site_request'});}}})(),startVisitorChat:function(){sendMessage('start_visitor_chat');},onSendChatByMail:function(params,callback){this.sendChatByMail(params,callback);},sendChatByMail:function(params,callback){sendMessage('send_chat_by_mail',params,callback);},onOperatorRate:function(rating){this.setOperatorRating(rating);},setOperatorRating:function(rating){sendMessage('set_operator_rating',{rating:rating,comment:null});},onChatTyping:function(){this.notifyWriting();},notifyWriting:function(){sendMessage('write_notify',false);},onChatClose:function(){this.closeChat();},closeChat:function(){sendMessage('close_chat');},getOperatorStatus:function(){return ComagicWidget.widget.consultant.Consultant.getOperatorStatus();},getOCState:function(){return ComagicWidget.widget.consultant.Consultant.getOCState();},trackEvent:function(category,action,name,value){this.push(['trackEvent',[category,action,name,value]]);},setProperty:function(name,value){this.push(['setProperty',[name,value]]);},getProperty:function(name,callback){this.push(['getProperty',[name,callback]]);},hasProperty:function(name,callback){this.push(['hasProperty',[name,callback]]);},deleteProperty:function(name){this.push(['deleteProperty',[name]]);},getUploadUrl:function(callback){this.push(['getUploadUrl',[callback]]);},getDTPhones:function(){return dt.phones;},getPhones:function(){return ComagicWidget.widget.common.Storage.getItem('_cmg_phones');},setOperatorId:function(id){this.push(['setOperatorId',[id,callback]]);},getSessionId:function(){return cookie.getSessionId();},getVisitorId:function(){return cookie.getVisitorId();},isReady:function(){return ComagicWidget.widget.consultant.Consultant.isReady();},trackLeadShow:function(params){sendMessage('track_lead_show',{action_type:params.action_type,action_log_id:params.action_log_id});},onLeadFormSubmit:function(log_id,data,callback){sendMessage('submit_lead_form',{log_id:log_id,data:data},callback);},onLeadFormCancel:function(log_id){sendMessage('cancel_lead_form',{log_id:log_id})},onLeadTimerUp:function(scenario_id){sendMessage('on_timer_up',{scenario_id:scenario_id})},remoteTraceback:function(e){var seen=[];sendMessage('remote_traceback',{site_key:_siteKey,err:JSON.stringify(e.message,function(key,val){if(typeof val=='object'){if(uLiB.util.arrayIndexOf(seen,val)>=0)
return undefined;seen.push(val);}
return val;})})},getCredentials:function(){return{site_key:ComagicWidget.settings.key(),visitor_id:Number(this.getVisitorId()),hit_id:Number(ComagicWidget.widget.analytics.Analytics.getHitId()),session_id:Number(this.getSessionId()),consultant_server_url:ComagicWidget.settings.getServerBaseUrl(),comagic_id:ComagicWidget.widget.analytics.Analytics.getComagicId()}},onOperatorStatusChange:function(isActive){}};u.apply(u.ns(ns),api);u.apply(u.ns('ComagicWidget.widget.common.Api'),{sendMessage:sendMessage,trackSysEvent:function(params){ComagicWidget.widget.analytics.Analytics.trackSysEvent(u.isObject(params)?params.component_event:params);}});})(window,'Comagic');